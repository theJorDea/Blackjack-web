<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack 21</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .card {
            width: 70px;
            height: 100px;
            background-color: white;
            color: black;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            margin: 0 5px;
            position: relative;
        }
        .card.red {
            color: #dc2626;
        }
        .card-appear {
            animation: cardAppear 0.3s ease-out forwards;
        }
        @keyframes cardAppear {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .download-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4f46e5;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .download-btn:hover {
            background-color: #4338ca;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <h1 class="text-4xl font-bold mb-8">Blackjack 21</h1>
    
    <div class="bg-slate-800 p-8 rounded-xl shadow-xl w-full max-w-2xl">
        <div class="text-center mb-6">
            <p id="message" class="text-xl mb-4">Welcome to Blackjack! Press 'New Game' to start.</p>
        </div>
        
        <div class="mb-8">
            <h2 class="text-lg font-semibold mb-2">Dealer's Hand: <span id="dealer-score">0</span></h2>
            <div id="dealer-cards" class="flex justify-center flex-wrap gap-2 min-h-[120px]"></div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-lg font-semibold mb-2">Your Hand: <span id="player-score">0</span></h2>
            <div id="player-cards" class="flex justify-center flex-wrap gap-2 min-h-[120px]"></div>
        </div>
        
        <div class="flex justify-center space-x-4">
            <button id="new-game-btn" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-medium">New Game</button>
            <button id="hit-btn" class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg font-medium" disabled>Hit</button>
            <button id="stand-btn" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg font-medium" disabled>Stand</button>
        </div>
    </div>
    
    <!-- Download button -->
    <button id="download-btn" class="download-btn">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
        Скачать игру
    </button>
    
    <script>
        // DOM Elements
        const messageEl = document.getElementById('message');
        const dealerCardsEl = document.getElementById('dealer-cards');
        const playerCardsEl = document.getElementById('player-cards');
        const dealerScoreEl = document.getElementById('dealer-score');
        const playerScoreEl = document.getElementById('player-score');
        const newGameBtn = document.getElementById('new-game-btn');
        const hitBtn = document.getElementById('hit-btn');
        const standBtn = document.getElementById('stand-btn');
        const downloadBtn = document.getElementById('download-btn');
        
        // Game State
        let deck = [];
        let playerCards = [];
        let dealerCards = [];
        let gameOver = true;
        
        // Card values and suits
        const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        const suits = [
            { symbol: '♠', name: 'spades', color: 'black' },
            { symbol: '♥', name: 'hearts', color: 'red' },
            { symbol: '♦', name: 'diamonds', color: 'red' },
            { symbol: '♣', name: 'clubs', color: 'black' }
        ];
        
        // Create and shuffle deck
        function createDeck() {
            const newDeck = [];
            for (const suit of suits) {
                for (const value of values) {
                    newDeck.push({ value, suit });
                }
            }
            return newDeck;
        }
        
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }
        
        // Draw a card from the deck
        function drawCard() {
            if (deck.length === 0) {
                deck = shuffleDeck(createDeck());
            }
            return deck.pop();
        }
        
        // Calculate hand score
        function calculateScore(cards) {
            let score = 0;
            let aces = 0;
            
            for (const card of cards) {
                if (card.value === 'A') {
                    aces++;
                    score += 11;
                } else if (['K', 'Q', 'J'].includes(card.value)) {
                    score += 10;
                } else {
                    score += parseInt(card.value);
                }
            }
            
            // Adjust for aces
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            
            return score;
        }
        
        // Display a card
        function displayCard(card, container, faceDown = false) {
            const cardEl = document.createElement('div');
            cardEl.classList.add('card', 'card-appear');
            
            if (!faceDown) {
                cardEl.classList.add(card.suit.color === 'red' ? 'red' : '');
                cardEl.textContent = card.value + card.suit.symbol;
            } else {
                cardEl.textContent = '?';
                cardEl.style.backgroundColor = '#334155';
                cardEl.style.color = '#e2e8f0';
            }
            
            container.appendChild(cardEl);
        }
        
        // Update scores
        function updateScores() {
            playerScoreEl.textContent = calculateScore(playerCards);
            
            // Only show full dealer score at end of game
            if (gameOver || dealerCards[0].faceDown === false) {
                dealerScoreEl.textContent = calculateScore(dealerCards);
            } else {
                // Show score of visible card only
                const visibleCards = dealerCards.filter(card => !card.faceDown);
                dealerScoreEl.textContent = calculateScore(visibleCards);
            }
        }
        
        // Check game state
        function checkGameState() {
            const playerScore = calculateScore(playerCards);
            
            if (playerScore > 21) {
                endGame('bust');
                return;
            }
            
            if (playerScore === 21) {
                standBtn.click(); // Auto-stand on 21
            }
        }
        
        // End game
        function endGame(result) {
            gameOver = true;
            
            // Reveal dealer's cards
            revealDealerCards();
            
            const playerScore = calculateScore(playerCards);
            const dealerScore = calculateScore(dealerCards);
            
            // Determine winner
            if (result === 'bust') {
                messageEl.textContent = 'Bust! You went over 21. Dealer wins.';
                messageEl.classList.add('text-red-400');
            } else if (dealerScore > 21) {
                messageEl.textContent = 'Dealer busts! You win!';
                messageEl.classList.add('text-green-400');
            } else if (playerScore > dealerScore) {
                messageEl.textContent = 'You win!';
                messageEl.classList.add('text-green-400');
            } else if (dealerScore > playerScore) {
                messageEl.textContent = 'Dealer wins!';
                messageEl.classList.add('text-red-400');
            } else {
                messageEl.textContent = "It's a tie!";
                messageEl.classList.add('text-yellow-400');
            }
            
            // Update buttons
            hitBtn.disabled = true;
            standBtn.disabled = true;
            newGameBtn.disabled = false;
        }
        
        // Reveal dealer's cards
        function revealDealerCards() {
            dealerCardsEl.innerHTML = '';
            for (const card of dealerCards) {
                card.faceDown = false;
                displayCard(card, dealerCardsEl);
            }
            updateScores();
        }
        
        // Dealer's turn
        function dealerPlay() {
            revealDealerCards();
            
            const dealerTurn = () => {
                const dealerScore = calculateScore(dealerCards);
                
                if (dealerScore < 17) {
                    // Dealer draws a card
                    setTimeout(() => {
                        const card = drawCard();
                        dealerCards.push(card);
                        displayCard(card, dealerCardsEl);
                        updateScores();
                        dealerTurn();
                    }, 700);
                } else {
                    // Dealer stands
                    endGame();
                }
            };
            
            setTimeout(dealerTurn, 500);
        }
        
        // Start new game
        function startNewGame() {
            // Reset game state
            playerCards = [];
            dealerCards = [];
            gameOver = false;
            
            // Clear cards
            dealerCardsEl.innerHTML = '';
            playerCardsEl.innerHTML = '';
            
            // Reset message
            messageEl.textContent = 'Game in progress...';
            messageEl.classList.remove('text-green-400', 'text-red-400', 'text-yellow-400');
            
            // Create deck if needed
            if (deck.length < 10) {
                deck = shuffleDeck(createDeck());
            }
            
            // Deal initial cards
            const dealerCard1 = drawCard();
            const playerCard1 = drawCard();
            const dealerCard2 = drawCard();
            const playerCard2 = drawCard();
            
            // Mark dealer's second card as face down
            dealerCard2.faceDown = true;
            
            // Add cards to hands
            dealerCards.push(dealerCard1, dealerCard2);
            playerCards.push(playerCard1, playerCard2);
            
            // Display initial cards
            displayCard(dealerCard1, dealerCardsEl);
            displayCard(dealerCard2, dealerCardsEl, true);
            displayCard(playerCard1, playerCardsEl);
            displayCard(playerCard2, playerCardsEl);
            
            // Update scores
            updateScores();
            
            // Check for blackjack
            if (calculateScore(playerCards) === 21) {
                messageEl.textContent = 'Blackjack!';
                setTimeout(dealerPlay, 800);
            } else {
                // Enable game buttons
                hitBtn.disabled = false;
                standBtn.disabled = false;
                newGameBtn.disabled = true;
            }
        }
        
        // Event Listeners
        newGameBtn.addEventListener('click', startNewGame);
        
        hitBtn.addEventListener('click', () => {
            const card = drawCard();
            playerCards.push(card);
            displayCard(card, playerCardsEl);
            updateScores();
            checkGameState();
        });
        
        standBtn.addEventListener('click', () => {
            hitBtn.disabled = true;
            standBtn.disabled = true;
            dealerPlay();
        });
        
        // Download functionality
        downloadBtn.addEventListener('click', () => {
            // Get the HTML content
            const htmlContent = document.documentElement.outerHTML;
            
            // Create a Blob with the HTML content
            const blob = new Blob([htmlContent], {type: 'text/html'});
            
            // Create a download link
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'blackjack-game.html';
            
            // Trigger download
            document.body.appendChild(a);
            a.click();
            
            // Cleanup
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        });
    </script>
</body>
</html> 